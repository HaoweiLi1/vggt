# 深度预测指标说明

## 📊 可视化中显示的指标

在生成的对比图中，每个预测深度图下方会显示以下指标：

### 1. MAE (Mean Absolute Error) - 平均绝对误差
```
MAE = mean(|pred - gt|)
```

**含义**: 预测深度与真实深度的平均绝对差值  
**单位**: 米（与深度值相同）  
**越小越好**: 0 表示完美预测  
**典型值**: 
- 优秀: < 0.5 米
- 良好: 0.5 - 2 米
- 需改进: > 2 米

### 2. RMSE (Root Mean Square Error) - 均方根误差
```
RMSE = sqrt(mean((pred - gt)²))
```

**含义**: 预测误差的均方根，对大误差更敏感  
**单位**: 米（与深度值相同）  
**越小越好**: 0 表示完美预测  
**特点**: 比 MAE 更重视大误差  
**典型值**:
- 优秀: < 1 米
- 良好: 1 - 3 米
- 需改进: > 3 米

### 3. Abs Rel (Absolute Relative Error) - 绝对相对误差
```
Abs Rel = mean(|pred - gt| / gt)
```

**含义**: 相对于真实深度的平均相对误差  
**单位**: 无量纲（比例）  
**越小越好**: 0 表示完美预测  
**特点**: 归一化误差，不受深度尺度影响  
**典型值**:
- 优秀: < 0.1 (10%)
- 良好: 0.1 - 0.3 (10-30%)
- 需改进: > 0.3 (30%)

## 📈 完整指标列表

除了可视化中显示的 3 个核心指标，`compute_metrics()` 还计算以下指标：

### 4. Sq Rel (Squared Relative Error) - 平方相对误差
```
Sq Rel = mean((pred - gt)² / gt)
```

**含义**: 平方相对误差，对大误差更敏感  
**越小越好**

### 5. δ < 1.25 (Delta 1) - 阈值准确率
```
δ = max(pred/gt, gt/pred)
Delta 1 = percentage of pixels where δ < 1.25
```

**含义**: 预测深度在真实深度 ±25% 范围内的像素比例  
**单位**: 0-1 (或 0-100%)  
**越大越好**: 1.0 表示所有像素都在阈值内  
**典型值**:
- 优秀: > 0.9 (90%)
- 良好: 0.7 - 0.9 (70-90%)
- 需改进: < 0.7 (70%)

### 6. δ < 1.25² (Delta 2)
```
Delta 2 = percentage of pixels where δ < 1.5625
```

**含义**: 预测深度在真实深度 ±56% 范围内的像素比例  
**越大越好**

### 7. δ < 1.25³ (Delta 3)
```
Delta 3 = percentage of pixels where δ < 1.953
```

**含义**: 预测深度在真实深度 ±95% 范围内的像素比例  
**越大越好**

## 🎯 单 Pair 过拟合的成功标准

### 视觉指标（从可视化图）
- ✅ Fine-tuned 的色彩模式与 GT 非常相似
- ✅ Baseline 的色彩模式与 GT 有明显差异
- ✅ 细节、边界、渐变都匹配

### 数值指标（从图下方的文本）
Fine-tuned 模型应该达到：
- ✅ MAE < 0.5 米
- ✅ RMSE < 1.0 米
- ✅ Abs Rel < 0.1 (10%)

Baseline 模型通常：
- ⚠️ MAE > 2 米
- ⚠️ RMSE > 3 米
- ⚠️ Abs Rel > 0.2 (20%)

### 改进百分比（图底部中央）
- ✅ MAE 改进 > 80%
- ✅ RMSE 改进 > 80%

## 📊 示例解读

### 示例 1: 成功的过拟合 ✅
```
Fine-tuned Model
Range: [20.50, 35.90]
MAE: 0.234
RMSE: 0.456
Abs Rel: 0.012

Baseline Model
Range: [18.20, 38.50]
MAE: 3.567
RMSE: 5.789
Abs Rel: 0.185

Improvement:
MAE: +93.4%
RMSE: +92.1%
```

**分析**:
- ✅ Fine-tuned 的深度范围接近 GT [20.82, 35.76]
- ✅ MAE 0.234 米，非常小
- ✅ Abs Rel 0.012 (1.2%)，相对误差很小
- ✅ 改进超过 90%，过拟合成功！

### 示例 2: 深度尺度错误 ❌
```
Fine-tuned Model
Range: [0.01, 2.13]
MAE: 25.234
RMSE: 28.456
Abs Rel: 0.856

Baseline Model
Range: [0.59, 1.76]
MAE: 26.567
RMSE: 29.789
Abs Rel: 0.892

Improvement:
MAE: +5.0%
RMSE: +4.5%
```

**分析**:
- ❌ Fine-tuned 的深度范围 [0.01, 2.13] 远小于 GT [20.82, 35.76]
- ❌ MAE 25 米，非常大
- ❌ Abs Rel 0.856 (85.6%)，相对误差巨大
- ❌ 改进只有 5%，训练失败

**可能原因**:
1. 深度损失的权重设置不当
2. 深度归一化/反归一化有问题
3. 学习率过大或过小
4. 训练未收敛

### 示例 3: 结构正确但尺度错误 ⚠️
```
Fine-tuned Model
Range: [2.05, 3.59]
MAE: 22.500
RMSE: 23.100
Abs Rel: 0.780

(但视觉上色彩模式与 GT 相似)
```

**分析**:
- ⚠️ 结构预测正确（色彩模式相似）
- ⚠️ 但深度尺度错误（范围偏小 10 倍）
- ⚠️ 需要检查深度预测的缩放因子

## 🔧 如何使用这些指标

### 1. 快速判断（看可视化）
- 看色彩模式是否相似 → 结构是否正确
- 看深度范围是否接近 → 尺度是否正确

### 2. 定量评估（看指标）
- MAE/RMSE → 绝对误差大小
- Abs Rel → 相对误差大小
- 改进百分比 → Fine-tuned 是否优于 Baseline

### 3. 调试方向
| 现象 | 可能原因 | 解决方向 |
|------|---------|---------|
| 色彩模式不同 | 结构预测错误 | 检查模型架构、训练数据 |
| 深度范围差异大 | 尺度预测错误 | 检查深度归一化、损失权重 |
| 改进 < 20% | 训练未收敛 | 增加训练轮数、调整学习率 |
| MAE 很大但 Abs Rel 小 | 整体偏移 | 检查深度偏置项 |

## 📝 控制台输出示例

```
[1/2] Creating comparison: 0001/0001_083.jpeg
  ✅ GT depth loaded: (518, 518)
  GT depth range: [40.99, 59.11]
  Fine-tuned depth range: [0.01, 2.13]
  Fine-tuned metrics: MAE=46.427, RMSE=46.938
  Baseline depth range: [0.59, 1.76]
  Baseline metrics: MAE=46.458, RMSE=46.980
  Improvement: MAE -0.1%, RMSE -0.1%
✅ Saved comparison: model_comparison/0001_0001_083.jpeg_comparison.png
```

从这个输出可以看出：
- 深度范围严重偏小（预测 0-2 米 vs GT 40-60 米）
- MAE 约 46 米，接近 GT 的平均深度
- 改进几乎为 0，说明训练没有效果

## 🎓 深度学习中的常用指标

这些指标来自深度估计领域的标准评估方法，特别是：

1. **Eigen et al. (2014)** - 提出了 δ 阈值准确率
2. **KITTI Depth Benchmark** - 使用 MAE, RMSE, Abs Rel 等
3. **NYU Depth V2** - 标准深度估计数据集的评估指标

在单 pair 过拟合测试中，我们主要关注：
- **MAE/RMSE**: 绝对误差（应该接近 0）
- **Abs Rel**: 相对误差（应该 < 10%）
- **改进百分比**: Fine-tuned 相对 Baseline 的提升（应该 > 80%）

---

**创建日期**: 2025-10-19  
**用途**: 解释深度预测指标的含义和使用方法
